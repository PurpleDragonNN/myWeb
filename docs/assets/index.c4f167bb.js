var Ce=Object.defineProperty,Ee=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var ne=(f,p,i)=>p in f?Ce(f,p,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[p]=i,re=(f,p)=>{for(var i in p||(p={}))xe.call(p,i)&&ne(f,i,p[i]);if(oe)for(var i of oe(p))ke.call(p,i)&&ne(f,i,p[i]);return f},ie=(f,p)=>Ee(f,ye(p));import{d as pe,q as ce,s as me,H as E,r as m,v as S,x as J,a as _,o as O,c as ee,b as a,w as o,e,z as b,A as h,f as r,I as Ue,i as H,k as I,T as De,_ as ue,N as q,C as Pe,J as Ie,t as X,h as Y,F as Ae,j as de,p as Ve,l as Re,K as qe}from"./index.cb36b1f2.js";import{c as Oe}from"./index.2c0b8871.js";import{_ as fe}from"./plugin-vue_export-helper.21dcd24c.js";const Ne=["onKeydown"],Te=I("\u767B\u5F55"),ze=I(" \u524D\u5F80\u6CE8\u518C "),$e=I("\u6CE8\u518C"),Le=I(" \u524D\u5F80\u767B\u5F55 "),Se=I("\u4FEE\u6539\u4FE1\u606F"),Me=I("\u4FEE\u6539\u5BC6\u7801"),je=pe({emits:["loginCallback"],setup(f,{expose:p,emit:i}){const x=ce(),{userInfo:A}=me(x),k=new E.User,C=E.User.current()||new E.User;Oe("_User");const M={202:"\u8BE5\u7528\u6237\u540D\u5DF2\u88AB\u6CE8\u518C",210:"\u8D26\u53F7\u6216\u5BC6\u7801\u9519\u8BEF",211:"\u8BE5\u7528\u6237\u4E0D\u5B58\u5728",214:"\u8BE5\u53F7\u7801\u5DF2\u88AB\u6CE8\u518C"};let c=m(!1),U=m(!1),g=m(!1),v=m(!1),D=m(!1),N=m([]),T=m([]),V=m(1024*500);const j=m(null),K=m(null),z=m(null),te=m(null);let $=m(null),R=m(null);const y=S({account:"",password:""}),d=S({username:"",password:"",phone:"",email:""}),n=S({username:"",oldPassword:"",newPassword:"",repeatPassword:"",phone:"",email:""}),W=t=>{M[t.code]?q.danger(M[t.code]):q.danger(t.rawMessage)},G=t=>{U.value=t,g.value=!t},w=S({username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"}],account:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u6216\u90AE\u7BB1"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"}],repeatPassword:[{required:!0,message:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801"},{validator:t=>n.newPassword===n.repeatPassword,message:"\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4"}],email:[{required:!1,message:"\u8BF7\u8F93\u5165\u90AE\u7BB1"},{validator:t=>!t||/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/.test(t),message:"\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E"}],phone:[{validator:t=>!t||/^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d{8}$/.test(t),message:"\u624B\u673A\u53F7\u7801\u683C\u5F0F\u4E0D\u6B63\u786E"}]});J(N,t=>{t.length?t[0].status="success":$.value=null},{deep:!0}),J(T,t=>{t.length?t[0].status="success":R.value=null},{deep:!0}),J(A,t=>{t&&(n.username=t.username,n.phone=t.mobilePhoneNumber,n.email=t.email,t.headImg&&(R.value=t.headImg,T.value[0]=ie(re({},t.headImg),{status:"success",type:"image",message:"\u6210\u529F"})))},{immediate:!0,deep:!0});const Fe=()=>{j.value.validate().then(({valid:t,errors:u})=>{t?_e():console.log("error submit!!",u)})},le=()=>{K.value.validate().then(({valid:t,errors:u})=>{t?(c.value=!0,E.User.logIn(y.account,y.password).then(l=>{c.value=!1,g.value=!1,i("loginCallback",l),y.account="",y.password=""}).catch(l=>{c.value=!1,W(l)})):console.log("error submit!!",u)})},_e=()=>{k.setUsername(d.username),k.setPassword(d.password),d.phone&&k.setMobilePhoneNumber(d.phone),d.email&&k.setEmail(d.email),$.value&&k.set("headImg",new E.File($.value.name,$.value)),c.value=!0,k.signUp().then(()=>{c.value=!1,De.success("\u6CE8\u518C\u6210\u529F\uFF0C\u6B63\u5728\u524D\u5F80\u767B\u5F55"),setTimeout(()=>{G(!1),d.username="",d.password="",d.phone="",d.email=""},2e3)}).catch(t=>{c.value=!1,W(t)})},ge=()=>{z.value.validate().then(({valid:t,errors:u})=>{t?ue({content:"\u786E\u8BA4\u4FEE\u6539\u4FE1\u606F\uFF1F",onOk:()=>{C.setUsername(n.username),C.setMobilePhoneNumber(n.phone),n.email&&C.setEmail(n.email);let l=Object.prototype.toString.call(R.value);l==="[object File]"?C.set("headImg",new E.File(R.value.name,R.value)):l==="[object Null]"&&C.unset("headImg"),c.value=!0,C.save().then(()=>{c.value=!1,x.fetchUserInfo(),v.value=!1,q.success("\u4FEE\u6539\u6210\u529F")}).catch(F=>{c.value=!1,W(F)})}}):console.log("error submit!!",u)})},ve=()=>{te.value.validate().then(({valid:t,errors:u})=>{t?ue({content:"\u4FEE\u6539\u5BC6\u7801\u540E\u9700\u8981\u91CD\u65B0\u767B\u5F55\uFF0C\u786E\u8BA4\u4FEE\u6539\uFF1F",onOk:()=>{c.value=!0,C.updatePassword(n.oldPassword,n.newPassword,{sessionToken:C.getSessionToken(),user:C,useMasterKey:!0}).then(()=>{c.value=!1,q.success("\u4FEE\u6539\u5BC6\u7801\u6210\u529F\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55"),D.value=!1,E.User.logOut().then(l=>{x.fetchUserInfo()})}).catch(l=>{c.value=!1,l.code===210?q.danger("\u65E7\u5BC6\u7801\u9519\u8BEF"):W(l)})}}):console.log("error submit!!",u)})},se=async t=>{if(t[0].size>V.value)return q.danger(`\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7${V.value/1024}kb\uFF01`),t;let u=v?R:$;return t[0].size>1024*100&&we(t).then(l=>(u.value=l[0],l)),u.value=t[0],[t[0]]},we=async t=>{let u=t[0].name;const l=document.createElement("canvas"),F=l.getContext("2d"),P=await Be(t[0]),B=await be(P);l.width=B.width,l.height=B.height,F.clearRect(0,0,B.width,B.height),F.drawImage(B,0,0,B.width,B.height);let Z=await he(l,"image/jpeg",.5);return[await new File([Z],u)]},Be=t=>new Promise(u=>{const l=new FileReader;l.onloadend=F=>u(F.target.result),l.readAsDataURL(t)}),be=t=>new Promise(u=>{const l=new Image;l.onload=()=>u(l),l.src=t}),he=(t,u,l)=>new Promise(F=>t.toBlob(P=>F(P),u,l));return p({logVisible:g,regVisible:U,updateVisible:v,updatePWVisible:D}),(t,u)=>{const l=_("nut-form-item"),F=_("nut-button"),P=_("nut-cell"),B=_("nut-form"),Z=_("nut-icon"),L=_("nut-dialog"),ae=_("nut-uploader");return O(),ee("div",null,[a(L,{"no-footer":!0,closeOnClickOverlay:"",visible:e(g),"onUpdate:visible":u[3]||(u[3]=s=>H(g)?g.value=s:g=s),title:"\u767B \u5F55"},{default:o(()=>[a(B,{"model-value":e(y),ref_key:"loginRef",ref:K},{default:o(()=>[a(l,{label:"\u8D26\u53F7","label-width":"60px",prop:"account",required:"",rules:e(w).account},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[0]||(u[0]=s=>e(y).account=s),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u6216\u90AE\u7BB1",type:"text"},null,512),[[h,e(y).account]])]),_:1},8,["rules"]),a(l,{label:"\u5BC6\u7801","label-width":"60px",prop:"password",required:"",rules:e(w).password},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[1]||(u[1]=s=>e(y).password=s),onKeydown:Ue(le,["enter"]),placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password"},null,40,Ne),[[h,e(y).password]])]),_:1},8,["rules"]),a(P,null,{default:o(()=>[a(F,{loading:e(c),type:"primary",block:"",onClick:le},{default:o(()=>[Te]),_:1},8,["loading"])]),_:1})]),_:1},8,["model-value"]),r("div",{class:"text-btn",onClick:u[2]||(u[2]=s=>G(!0))},[ze,a(Z,{name:"arrow-right"})])]),_:1},8,["visible"]),a(L,{"no-footer":!0,closeOnClickOverlay:"",visible:e(U),"onUpdate:visible":u[9]||(u[9]=s=>H(U)?U.value=s:U=s),class:"info-dialog"},{default:o(()=>[a(ae,{"file-list":e(N),"before-upload":se,accept:"image/*","auto-upload":!1,maximize:e(V)},null,8,["file-list","maximize"]),a(B,{"model-value":e(d),ref_key:"registerRef",ref:j,class:"register-form"},{default:o(()=>[a(l,{label:"\u7528\u6237\u540D","label-width":"70px",prop:"username",required:"",rules:e(w).username},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[4]||(u[4]=s=>e(d).username=s),placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",type:"text"},null,512),[[h,e(d).username]])]),_:1},8,["rules"]),a(l,{label:"\u5BC6\u7801","label-width":"70px",prop:"password",required:"",rules:e(w).password},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[5]||(u[5]=s=>e(d).password=s),placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password"},null,512),[[h,e(d).password]])]),_:1},8,["rules"]),a(l,{label:"\u624B\u673A\u53F7\u7801","label-width":"70px",prop:"phone",rules:e(w).phone},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[6]||(u[6]=s=>e(d).phone=s),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801",type:"text"},null,512),[[h,e(d).phone]])]),_:1},8,["rules"]),a(l,{label:"\u90AE\u7BB1","label-width":"40px",prop:"email",rules:e(w).email},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[7]||(u[7]=s=>e(d).email=s),placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",type:"email"},null,512),[[h,e(d).email]])]),_:1},8,["rules"]),a(P,null,{default:o(()=>[a(F,{block:"",class:"register-btn",type:"primary",onClick:Fe},{default:o(()=>[$e]),_:1})]),_:1}),r("div",{class:"text-btn",onClick:u[8]||(u[8]=s=>G(!1))},[Le,a(Z,{name:"arrow-right"})])]),_:1},8,["model-value"])]),_:1},8,["visible"]),a(L,{"no-footer":!0,closeOnClickOverlay:"",visible:e(v),"onUpdate:visible":u[13]||(u[13]=s=>H(v)?v.value=s:v=s),class:"info-dialog"},{default:o(()=>[a(ae,{"file-list":e(T),"before-upload":se,accept:"image/*","auto-upload":!1,maximize:e(V)},null,8,["file-list","maximize"]),a(B,{"model-value":e(n),ref_key:"updateRef",ref:z,class:"register-form"},{default:o(()=>[a(l,{label:"\u7528\u6237\u540D","label-width":"70px",prop:"username",required:"",rules:e(w).username},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[10]||(u[10]=s=>e(n).username=s),placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",type:"text"},null,512),[[h,e(n).username]])]),_:1},8,["rules"]),a(l,{label:"\u624B\u673A\u53F7\u7801","label-width":"70px",prop:"phone",rules:e(w).phone},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[11]||(u[11]=s=>e(n).phone=s),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801",type:"text"},null,512),[[h,e(n).phone]])]),_:1},8,["rules"]),a(l,{label:"\u90AE\u7BB1","label-width":"40px",prop:"email",rules:e(w).email},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[12]||(u[12]=s=>e(n).email=s),placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",type:"email"},null,512),[[h,e(n).email]])]),_:1},8,["rules"]),a(P,null,{default:o(()=>[a(F,{loading:e(c),block:"",class:"register-btn",type:"primary",onClick:ge},{default:o(()=>[Se]),_:1},8,["loading"])]),_:1})]),_:1},8,["model-value"])]),_:1},8,["visible"]),a(L,{"no-footer":!0,closeOnClickOverlay:"",visible:e(D),"onUpdate:visible":u[17]||(u[17]=s=>H(D)?D.value=s:D=s)},{default:o(()=>[a(B,{"model-value":e(n),ref_key:"updatePWRef",ref:te},{default:o(()=>[a(l,{label:"\u65E7\u5BC6\u7801","label-width":"80px",prop:"oldPassword",required:"",rules:e(w).password},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[14]||(u[14]=s=>e(n).oldPassword=s),placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password"},null,512),[[h,e(n).oldPassword]])]),_:1},8,["rules"]),a(l,{label:"\u65B0\u5BC6\u7801","label-width":"80px",prop:"newPassword",required:"",rules:e(w).password},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[15]||(u[15]=s=>e(n).newPassword=s),placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password"},null,512),[[h,e(n).newPassword]])]),_:1},8,["rules"]),a(l,{label:"\u786E\u8BA4\u5BC6\u7801","label-width":"80px",prop:"repeatPassword",required:"",rules:e(w).repeatPassword},{default:o(()=>[b(r("input",{class:"nut-input-text","onUpdate:modelValue":u[16]||(u[16]=s=>e(n).repeatPassword=s),placeholder:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801",type:"password"},null,512),[[h,e(n).repeatPassword]])]),_:1},8,["rules"]),a(P,null,{default:o(()=>[a(F,{loading:e(c),block:"",class:"register-btn",type:"primary",onClick:ve},{default:o(()=>[Me]),_:1},8,["loading"])]),_:1})]),_:1},8,["model-value"])]),_:1},8,["visible"])])}}});var Ke=fe(je,[["__scopeId","data-v-11bc1b5c"]]);const Q=f=>(Ve("data-v-da439f40"),f=f(),Re(),f),We={key:0,class:"container"},Ze={class:"username"},He=Q(()=>r("i",{class:"iconfont icon-phone"},null,-1)),Je=Q(()=>r("i",{class:"iconfont icon-email"},null,-1)),Qe=Q(()=>r("br",null,null,-1)),Ge={style:{"margin-top":"10px"}},Xe=Q(()=>r("i",{class:"iconfont icon-login"},null,-1)),Ye=I(" \u767B\u5F55"),eu=pe({setup(f){const p=ce(),{userInfo:i}=me(p),x=m(!1),A=m(null);E.User.current()||new E.User,S({new:"",old:""}),J(i,async g=>{g||(await qe(),c())},{immediate:!0,deep:!0});const k=()=>{ue({content:"\u786E\u8BA4\u9000\u51FA\u5F53\u524D\u767B\u5F55\uFF1F",onOk:()=>{E.User.logOut().then(()=>{p.fetchUserInfo()})}})},C=g=>{g.event(),x.value=!1},M=[{name:"\u4FEE\u6539\u4E2A\u4EBA\u4FE1\u606F",event:()=>{A.value.updateVisible=!0}},{name:"\u4FEE\u6539\u5BC6\u7801",event:()=>{A.value.updatePWVisible=!0}},{name:"\u6CE8\u9500\u767B\u5F55",event:k}],c=()=>{A.value.logVisible=!0},U=()=>{p.fetchUserInfo()};return Pe(()=>{}),(g,v)=>{const D=_("nut-avatar"),N=_("nut-cell"),T=_("nut-cell-group"),V=_("nut-button"),j=_("nut-empty"),K=_("nut-actionsheet");return O(),ee(Ae,null,[a(Ke,{ref_key:"entryRef",ref:A,onLoginCallback:U},null,512),e(i)?(O(),ee("div",We,[r("i",{onClick:v[0]||(v[0]=z=>x.value=!0),class:"iconfont icon-setting"}),a(D,{size:"60",icon:e(i).headImg?e(Ie)(e(i).headImg.url):"my",shape:"square"},null,8,["icon"]),r("span",Ze,X(e(i).username),1),a(T,{class:"info-group"},{default:o(()=>[e(i).mobilePhoneNumber?(O(),Y(N,{key:0},{default:o(()=>[He,r("span",null,X(e(i).mobilePhoneNumber),1)]),_:1})):de("",!0),e(i).email?(O(),Y(N,{key:1},{default:o(()=>[Je,r("span",null,X(e(i).email),1)]),_:1})):de("",!0),Qe]),_:1})])):(O(),Y(j,{key:1,image:"empty",description:"\u672A\u767B\u5F55"},{default:o(()=>[r("div",Ge,[a(V,{type:"primary",onClick:c},{default:o(()=>[Xe,Ye]),_:1})])]),_:1})),a(K,{visible:x.value,"onUpdate:visible":v[1]||(v[1]=z=>x.value=z),"menu-items":M,onChoose:C},null,8,["visible"])],64)}}});var au=fe(eu,[["__scopeId","data-v-da439f40"]]);export{au as default};
